# Security

## AWS IoT security

Each connected **device** or **client** must have a credential to interact with AWS IoT. All traffic to and from AWS IoT is sent securely over **Transport Layer Security (TLS)**. AWS cloud security mechanisms protect data as it moves between AWS IoT and other AWS services.

put a simple image here 

things certificates policiey etc

- You are responsible for managing device credentials and policies in AWS IoT. For more information, see Key management in AWS IoT. You are responsible for assigning **unique identities to each device** and managing the permissions for each device or group of devices.

- Your devices connect to AWS IoT using **X.509 certificates** or over a secure TLS connection. 

- When using AWS IoT authentication, the message broker is responsible for authenticating your devices, securely ingesting device data, and granting or denying access permissions you specify for your devices using **AWS IoT policies**.

## Authentication

Authentication is a mechanism where you verify the identity of a **client** or a **server**. **Server authentication** is the process where devices or other clients ensure they are communicating with an actual AWS IoT endpoint. **Client authentication** is the process where devices or other clients authenticate themselves with AWS IoT.

### X.509 Certificate overview

X.509 certificates are digital certificates that use the X.509 public key infrastructure standard to associate a public key with an identity contained in a certificate. X.509 certificates are issued by a trusted entity called a certification authority (CA). The CA maintains one or more special certificates called CA certificates that it uses to issue X.509 certificates. Only the certification authority has access to CA certificates. X.509 certificate chains are used both for server authentication by clients and client authentication by the server.

### Server authentication

### Client authentication
AWS IoT supports three types of identity principals for device or client authentication:

- X.509 client certificates **(Used by AWS IoT devices)**

- IAM users, groups, and roles **(Used by Web and desktop applications)**

- Amazon Cognito identities **(Used by mobile applications)**

### X.509 Client Certificates

X.509 certificates provide AWS IoT with the ability to authenticate client and device connections. Client certificates must be registered with AWS IoT before a client can communicate with AWS IoT.

It is recommended to give a **unique certificate each device or client** to enable fine-grained client management actions, including **certificate revocation**. Devices and clients must also support rotation and replacement of certificates to help ensure smooth operation as certificates expire.

AWS IoT supports these types of X.509 client certificates:

- X.509 certificates generated by AWS IoT

- X.509 certificates signed by a CA registered with AWS IoT.

- X.509 certificates signed by a CA that is not registered with AWS IoT.

#### Using X.509 client certificates

X.509 certificates authenticate client and device connections to AWS IoT. X.509 certificates provide several benefits over other identification and authentication mechanisms. **X.509 certificates enable asymmetric keys to be used with devices.** For example, you could burn **private keys into secure storage on a device** so that sensitive cryptographic material never leaves the device. X.509 certificates provide stronger client authentication over other schemes, such as user name and password or bearer tokens, because the private key never leaves the device.

AWS IoT authenticates client certificates using the TLS protocol's client authentication mode. TLS support is available in many programming languages and operating systems and is commonly used for encrypting data. In TLS client authentication, AWS IoT requests an X.509 client certificate and validates the certificate's status and AWS account against a registry of certificates. It then challenges the client for proof of ownership of the private key that corresponds to the public key contained in the certificate. AWS IoT requires clients to send the Server Name Indication (SNI) extension to the Transport Layer Security (TLS) protocol. For more information on configuring the SNI extension, see Transport security in AWS IoT.

X.509 certificates can be verified against a trusted certificate authority (CA). You can create client certificates that use the Amazon Root CA and you can use your own client certificates signed by another CA. For more information about using your own X.509 certificates, see Create your own client certificates.

The date and time when certificates signed by a CA certificate expire are set when the certificate is created. X.509 certificates generated by AWS IoT expire at midnight UTC on December 31, 2049 (2049-12-31T23:59:59Z). For more information about using the AWS IoT console to create certificates that use the Amazon Root CA, see Create AWS IoT client certificates.


## Security best practices in AWS IoT Core
This section contains information about security best practices for AWS IoT Core. 

- [Use a single identity per device](#use-a-single-identity-per-device)-
- [Use a single identity per device](#use-a-single-identity-per-device)

### Keep device's clock in sync
It's important to have an accurate time on your device. **X.509 certificates have an expiry date and time**. The clock on your device is used to **verify that a server certificate is still valid**. If you're building commercial IoT devices, remember that your products may be stored for extended periods before being sold. Real-time clocks can drift during this time and batteries can get discharged, so setting time in the factory is not sufficient.

For most systems, this means that the **device's software must include a network time protocol (NTP) client.** The device should wait until it synchronizes with an NTP server before it tries to connect to AWS IoT Core. If this isn't possible, the system should provide a way for a user to set the device's time so that subsequent connections succeed.

After the device synchronizes with an NTP server, it can open a connection with AWS IoT Core. 

### Use a single identity per device
Devices generally use X.509 client certificates. Web and mobile applications use Amazon Cognito Identity. This enables you to apply fine-grained permissions to your devices.

For example, you have an application that consists of a mobile phone device that receives status updates from two different smart home objects â€“ a light bulb and a thermostat. The light bulb sends the status of its battery level, and a thermostat sends messages that report the temperature.

AWS IoT authenticates devices individually and treats each connection individually. You can apply fine-grained access controls using authorization policies. You can define a policy for the thermostat that allows it to publish to a topic space. You can define a separate policy for the light bulb that allows it to publish to a different topic space. Finally, you can define a policy for the mobile app that only allows it to connect and subscribe to the topics for the thermostat and the light bulb to receive messages from these devices.

Apply the principle of least privilege and scope down the permissions per device as much as possible. All devices or users should have an AWS IoT policy in AWS IoT that **only allows it to connect with a known client ID, and to publish and subscribe to an identified and fixed set of topics.**

### Use a second AWS Region as backup
Consider storing a copy of your data in a second AWS Region as a backup.


### Use just in time provisioning
Manually creating and provisioning each device can be time consuming. AWS IoT provides a way to define a template to provision devices when they first connect to AWS IoT.


### Validate the server certificate
The first thing a device does to interact with AWS IoT is to open a secure connection. When you connect your device to AWS IoT, ensure that you're talking to AWS IoT and not another server impersonating AWS IoT. Each of the AWS IoT servers is provisioned with a certificate issued for the iot.amazonaws.com domain. This certificate was issued to AWS IoT by a trusted certificate authority that verified our identity and ownership of the domain.

One of the first things AWS IoT Core does when a device connects is send the device a server certificate. Devices can verify that they were expecting to connect to iot.amazonaws.com and that the server on the end of that connection possesses a certificate from a trusted authority for that domain.

TLS certificates are in X.509 format and include a variety of information such as the organization's name, location, domain name, and a validity period. The validity period is specified as a pair of time values called notBefore and notAfter. Services like AWS IoT Core use limited validity periods (for example, one year) for their server certificates and begin serving new ones before the old ones expire.

